<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>توليد الدعوات المخصصة</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    @font-face {
      font-family: 'Madani Arabic Bold';
      src: url('fonts/MadaniArabic-Bold.ttf') format('truetype');
    }
    @font-face {
      font-family: 'Madani Arabic Light';
      src: url('fonts/MadaniArabic-Light.ttf') format('truetype');
    }
    body {
      direction: rtl;
      background-color: #f8f9fa;
    }
    svg {
      width: 100%;
      height: auto;
      border: 1px solid #ccc;
      margin: 20px 0;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container my-4">
    <div class="row">
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm border-primary">
          <div class="card-header bg-primary text-white">
            <h4 class="card-title mb-0">أدخل بيانات الدعوة</h4>
          </div>
          <div class="card-body">
            <form id="invitationForm">
              <div class="mb-3">
                <label for="employeeName" class="form-label">اسم الموظف</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-person"></i></span>
                  <input type="text" id="employeeName" class="form-control" placeholder="أدخل اسم الموظف">
                </div>
              </div>
              <div class="mb-3">
                <label for="jobTitle" class="form-label">المسمى الوظيفي</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-briefcase"></i></span>
                  <input type="text" id="jobTitle" class="form-control" placeholder="أدخل المسمى الوظيفي">
                </div>
              </div>
              <div class="d-grid gap-2">
                <button type="button" onclick="downloadImage()" class="btn btn-success">حفظ كصورة PNG</button>
                <button type="button" onclick="downloadPDF()" class="btn btn-primary">حفظ كملف PDF</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col-lg-6 mb-4">
        <svg id="invitationSvg" viewBox="0 0 1080 1920">
          <image id="bgImage" href="inv-1.svg" x="0" y="0" width="1080" height="1920" />
          <g id="textGroup" transform="translate(540,960)">
            <text id="employeeNameText" text-anchor="middle" font-family="Madani Arabic Bold" font-size="70" fill="#D38054" y="440">
              اسم الموظف
            </text>
            <text id="jobTitleText" text-anchor="middle" font-family="Madani Arabic Light" font-size="50" fill="#000" y="340">
              المسمى الوظيفي
            </text>
          </g>
        </svg>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('employeeName').addEventListener('input', updateInvitation);
    document.getElementById('jobTitle').addEventListener('input', updateInvitation);

    function updateInvitation() {
      document.getElementById('employeeNameText').textContent = document.getElementById('employeeName').value || "اسم الموظف";
      document.getElementById('jobTitleText').textContent = document.getElementById('jobTitle').value || "المسمى الوظيفي";
    }

    async function convertSvgToCanvas() {
      const svg = document.getElementById("invitationSvg");
      const serializer = new XMLSerializer();
      const svgString = serializer.serializeToString(svg);
      const img = new Image();
      const canvas = document.createElement("canvas");
      canvas.width = 1080;
      canvas.height = 1920;
      const ctx = canvas.getContext("2d");
      return new Promise(resolve => {
        img.onload = function () {
          ctx.drawImage(img, 0, 0);
          resolve(canvas);
        };
        img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
      });
    }

    async function downloadImage() {
      const canvas = await convertSvgToCanvas();
      canvas.toBlob(blob => {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "دعوة.png";
        link.click();
      }, "image/png");
    }

    async function downloadPDF() {
      const canvas = await convertSvgToCanvas();
      canvas.toBlob(blob => {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({ format: [1080, 1920] });
        const reader = new FileReader();
        reader.onloadend = function () {
          pdf.addImage(reader.result, "PNG", 0, 0, 1080, 1920);
          pdf.save("دعوة.pdf");
        };
        reader.readAsDataURL(blob);
      }, "image/png");
    }
  </script>
</body>
</html>
